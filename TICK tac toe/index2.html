<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Tic Tac Toe</title>
<style>
  body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: radial-gradient(circle at top, #141e30, #243b55);
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100vh;
    padding-top: 20px;
  }

  h1 {
    text-shadow: 0 0 20px #00ffff;
    text-align: center;
    margin-bottom: 10px;
  }

  select, button {
    padding: 10px 15px;
    border: none;
    border-radius: 8px;
    background: #00bcd4;
    color: white;
    cursor: pointer;
    margin: 5px;
    font-size: 1rem;
  }

  .board {
    display: grid;
    gap: 6px;
    margin-top: 15px;
    justify-content: center;
    align-content: center;
    max-width: 40vw;
  }

  .cell {
    background: rgba(255,255,255,0.15);
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    aspect-ratio: 1 / 1;
    color: #00e5ff;
    cursor: pointer;
    transition: background 0.3s, transform 0.1s;
    user-select: none;
  }

  .cell:hover {
    background: rgba(255,255,255,0.25);
    transform: scale(1.05);
  }

  .winner {
    margin-top: 15px;
    text-shadow: 0 0 10px #00ff88;
    font-size: 1.1em;
    text-align: center;
  }

  @media (max-width: 600px) {
    h1 { font-size: 1.3rem; }
    select, button { font-size: 0.9rem; padding: 8px 10px; }
  }
</style>
</head>
<body>

<h1>‚ú® Ultimate Tic Tac Toe ‚ú®</h1>

<div class="controls">
  <label for="mode">Mode:</label>
  <select id="mode">
    <option value="1">Single Player (vs AI)</option>
    <option value="2">2 Players (3√ó3)</option>
    <option value="3">3 Players (4√ó4)</option>
    <option value="4">4 Players (6√ó6)</option>
  </select>
  <button id="startBtn">Start Game</button>
</div>

<div class="board" id="board"></div>
<div class="winner" id="winner"></div>
<button id="resetBtn" style="display:none;">Restart</button>

<script>
  const board = document.getElementById("board");
  const winnerText = document.getElementById("winner");
  const resetBtn = document.getElementById("resetBtn");
  const startBtn = document.getElementById("startBtn");
  const modeSelect = document.getElementById("mode");

  const symbols = ["‚ùå", "‚≠ï", "üü°", "üü¢"];
  let mode, players, gameState, currentPlayer, gameActive, boardSize;

  startBtn.addEventListener("click", startGame);
  resetBtn.addEventListener("click", startGame);

  function startGame() {
    board.innerHTML = "";
    winnerText.textContent = "";
    resetBtn.style.display = "none";
    mode = parseInt(modeSelect.value);
    players = symbols.slice(0, mode);
    currentPlayer = 0;
    gameActive = true;

    // Set board size dynamically
    if (mode === 1 || mode === 2) boardSize = 3;
    else if (mode === 3) boardSize = 4;
    else boardSize = 6;

    gameState = Array(boardSize * boardSize).fill("");

    // Adjust cell size dynamically
    const cellSize = Math.min(80 / boardSize, 20); // ensure fit for mobile
    
    // ‚¨áÔ∏è CORRECTED THIS LINE (Used backticks ``)
    board.style.gridTemplateColumns = `repeat(${boardSize}, minmax(30px, ${cellSize}vw))`;

    for (let i = 0; i < boardSize * boardSize; i++) {
      const cell = document.createElement("div");
      cell.classList.add("cell");
      cell.dataset.index = i;
      
      // ‚¨áÔ∏è CORRECTED THIS LINE (Used backticks ``)
      cell.style.fontSize = `${4.5 - boardSize * 0.5}vw`; // smaller on bigger boards
      
      cell.addEventListener("click", handleClick);
      board.appendChild(cell);
    }
  }

  function handleClick(e) {
    const index = e.target.dataset.index;
    if (!gameActive || gameState[index] !== "") return;

    gameState[index] = players[currentPlayer];
    e.target.textContent = players[currentPlayer];

    if (checkWinner()) {
      winnerText.textContent = `üéâ Player ${currentPlayer + 1} (${players[currentPlayer]}) Wins!`;
      gameActive = false;
      resetBtn.style.display = "block";
      return;
    }

    if (gameState.every(c => c !== "")) {
      winnerText.textContent = "ü§ù Draw!";
      gameActive = false;
      resetBtn.style.display = "block";
      return;
    }

    if (mode === 1 && currentPlayer === 0) {
      currentPlayer = 1;
      aiMove();
      return;
    }

    currentPlayer = (currentPlayer + 1) % mode;
  }

  // Smarter AI ‚Äî tries to win or block
  function aiMove() {
    const empty = gameState.map((v,i)=>v===""?i:null).filter(v=>v!==null);

    // Try to win
    for (let i of empty) {
      gameState[i] = symbols[1];
      if (checkWinner()) { return finalizeAIMove(i); }
      gameState[i] = "";
    }

    // Try to block player
    for (let i of empty) {
      gameState[i] = symbols[0];
      if (checkWinner()) {
        gameState[i] = symbols[1];
        return finalizeAIMove(i);
      }
      gameState[i] = "";
    }

    // Else random
    const move = empty[Math.floor(Math.random()*empty.length)];
    finalizeAIMove(move);
  }

  function finalizeAIMove(index) {
    setTimeout(()=>{
      gameState[index] = symbols[1];
      board.children[index].textContent = symbols[1];
      if (checkWinner()) {
        winnerText.textContent = "ü§ñ AI Wins!";
        gameActive = false;
        resetBtn.style.display = "block";
        return;
      }
      if (gameState.every(c => c !== "")) {
        winnerText.textContent = "ü§ù Draw!";
        gameActive = false;
        resetBtn.style.display = "block";
        return;
      }
      currentPlayer = 0;
    }, 400);
  }

  // ‚úÖ Check winner dynamically (any board size)
  function checkWinner() {
    const lines = [];

    // Rows
    for (let r = 0; r < boardSize; r++) {
      lines.push([...Array(boardSize).keys()].map(i => r * boardSize + i));
    }
    // Columns
    for (let c = 0; c < boardSize; c++) {
      lines.push([...Array(boardSize).keys()].map(i => i * boardSize + c));
    }
    // Diagonals
    lines.push([...Array(boardSize).keys()].map(i => i * (boardSize + 1)));
    lines.push([...Array(boardSize).keys()].map(i => (i + 1) * (boardSize - 1)));

    return lines.some(line => {
      const values = line.map(i => gameState[i]);
      return values[0] && values.every(v => v === values[0]);
    });
  }
</script>
</body>
</html>